using Microsoft.AspNetCore.Mvc;

namespace Techcore_Internship.WebApi.Controllers;

[ApiController]
[Route("api/[controller]")]
public class Task359_2_KubernetesConceptsController : ControllerBase
{
    [HttpGet]
    public string GetEssay()
    {
        return @"Основные концепции Kubernetes: Изучаем алфавит оркестрации контейнеров

Введение в ключевые концепции Kubernetes:
Kubernetes (K8s) — это мощная платформа для оркестрации контейнеров, ставшая промышленным стандартом для развертывания, масштабирования и управления контейнеризированными приложениями. Понимание основных строительных блоков критически важно для любого .NET разработчика, работающего с облачными приложениями.

Архитектурный обзор Kubernetes:

1. Pod (Под) - Атомарная единица развертывания
Pod представляет собой наименьшую развертываемую единицу в Kubernetes, но это больше, чем просто обертка для контейнера. Это «логический хост», предоставляющий общий контекст выполнения для одного или нескольких контейнеров.

Ключевые характеристики Pod:
- Общее сетевое пространство: Контейнеры в Pod используют один IP-адрес
- Общие тома хранения: Контейнеры имеют доступ к одним и тем же данным
- Общий жизненный цикл: Pod'ы создаются и удаляются как единое целое
- Эфемерная природа: Pod'ы предназначены для быстрой замены

Для .NET разработчиков: Типичное ASP.NET Core приложение работает в Pod с одним контейнером, в то время как более сложные микросервисы могут использовать multi-container Pod для sidecar-паттернов.

2. Deployment (Развертывание) - Декларативный менеджер приложений
Deployment — это рабочая лошадка управления приложениями в Kubernetes. Он предоставляет декларативный способ управления Pod'ами через описание желаемого состояния.

Возможности Deployment:
- Rolling updates: Обновление приложений без простоя
- Откат изменений: Мгновенный возврат к предыдущим версиям
- Масштабирование: Горизонтальное масштабирование одной командой
- Самовосстановление: Автоматическая замена упавших Pod'ов
- Управление версиями: Поддержка нескольких версий одновременно

Магия Deployment заключается в цикле согласования — постоянном сравнении фактического состояния с желаемым.

3. Service (Сервис) - Стабильная сетевая абстракция
Service решает фундаментальную проблему сетевого подключения в динамичной среде, где Pod'ы постоянно создаются и удаляются.

Типы Service и их назначение:
- ClusterIP: Внутренний сервис, доступный только внутри кластера
- NodePort: Открывает сервис на каждом узле на статическом порту
- LoadBalancer: Создает внешний балансировщик нагрузки в облачных провайдерах
- ExternalName: Перенаправление на внешний DNS

Service обеспечивает постоянную точку входа к динамически меняющемуся набору Pod'ов, используя механизмы селекторов и меток (labels).

4. ConfigMap (Карта конфигурации) - Управление конфигурацией
ConfigMap позволяет отделить конфигурацию от образа контейнера, что является ключевым принципом 12-факторных приложений.

Преимущества ConfigMap:
- Централизованное хранение конфигурации
- Динамическое обновление без пересборки образов
- Поддержка разных форматов (ключ-значение, файлы)
- Интеграция с переменными окружения

Для .NET приложений: ConfigMap может содержать appsettings.json, строки подключения, флаги функций и другие настройки.

5. Secret (Секрет) - Безопасное хранение чувствительных данных
Secret похож на ConfigMap, но предназначен для хранения конфиденциальной информации с дополнительными уровнями защиты.

Типы данных для Secret:
- Пароли и токены аутентификации
- TLS/SSL сертификаты
- SSH ключи
- Ключи шифрования базы данных

Важно: Хотя Secret обеспечивает базовую защиту, для максимальной безопасности требуется дополнительное шифрование.

6. PersistentVolumeClaim (PVC) - Управление постоянным хранилищем
PVC предоставляет абстракцию над физическим хранилищем, позволяя приложениям запрашивать дисковое пространство без знания деталей реализации.

Архитектура хранения в Kubernetes:
- StorageClass: Определяет тип хранилища (SSD, HDD, облачное)
- PersistentVolume (PV): Реальный ресурс хранения
- PersistentVolumeClaim (PVC): Запрос на выделение ресурсов
- Volume: Монтирование в Pod

PVC обеспечивает сохранность данных при перезапуске Pod'ов, что критически важно для stateful приложений, таких как базы данных.

Практическое применение для .NET разработчиков:

Типичная архитектура .NET приложения в Kubernetes:
1. Deployment для управления репликами приложения
2. Service для внешнего доступа (обычно LoadBalancer)
3. ConfigMap для настроек приложения
4. Secret для строк подключения к базе данных
5. PVC для хранения логов и файлов
6. HorizontalPodAutoscaler для автоматического масштабирования

Пример манифеста Deployment для ASP.NET Core:
apiVersion: apps/v1
kind: Deployment
metadata:
  name: dotnet-api
spec:
  replicas: 3
  selector:
    matchLabels:
      app: dotnet-api
  template:
    metadata:
      labels:
        app: dotnet-api
    spec:
      containers:
      - name: api
        image: myregistry/dotnet-api:latest
        ports:
        - containerPort: 80
        envFrom:
        - configMapRef:
            name: app-config
        - secretRef:
            name: db-secrets
        volumeMounts:
        - name: data-volume
          mountPath: /app/data
      volumes:
      - name: data-volume
        persistentVolumeClaim:
          claimName: app-data-pvc

Ключевые принципы проектирования:

1. Идемпотентность: Все объекты Kubernetes декларативны и идемпотентны
2. Селекторы и метки: Основной механизм связывания объектов
3. Контроллеры и операторы: Реализуют паттерн control loop
4. Согласование состояния: Постоянное приведение к желаемому состоянию
5. Плагин архитектура: Расширяемость через CRD и операторы";
    }
}
