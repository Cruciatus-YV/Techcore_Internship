using Microsoft.AspNetCore.Mvc;

namespace Techcore_Internship.WebApi.Controllers
{
    public class Task353_1_RabbitVsKafka : ControllerBase
    {
        /// <summary>
        /// Описание различий между умным и глупым брокером.
        /// </summary>
        [HttpGet]
        [Route("rabbit-vs-kafka")]
        public IActionResult GetCookiesVsTokens()
        {
            var explanation = @"
Эссе: RabbitMQ vs Kafka - ""Умный брокер"" vs ""Глупый брокер""

КОНЦЕПЦИЯ ""УМНЫЙ БРОКЕР"" (RABBITMQ) VS ""ГЛУПЫЙ БРОКЕР"" (KAFKA)

RabbitMQ: ""Умный брокер / глупые клиенты""

RabbitMQ действует как интеллектуальный посредник, который:
- Управляет состоянием сообщений: знает, какие сообщения доставлены, какие ожидают обработки
- Реализует сложные паттерны маршрутизации: direct, fanout, topic exchanges
- Гарантирует доставку: подтверждения (ACK), повторные отправки, dead letter queues
- Управляет очередями: приоритеты, TTL, ограничения по длине
- Требует от клиентов минимальной логики: просто подключись и работай

Аналогия: Почтовое отделение, где почтальон (RabbitMQ) знает точный адрес 
каждого получателя и гарантирует доставку письма.

Kafka: ""Глупый брокер / умные клиенты""

Kafka функционирует как простой, но надежный журнал событий:
- Не управляет состоянием потребителей: не отслеживает, кто что прочитал
- Минимальная логика маршрутизации: только топики и партиции
- Хранит все события: не удаляет после чтения, позволяет перечитывать
- Передает ответственность клиентам: клиенты сами управляют своими офсетами, 
  обработкой ошибок, балансировкой
- Клиенты должны быть ""умными"": знать о партициях, репликах, офсетах

Аналогия: Бесконечная лента новостей, где каждый читатель (клиент) сам решает, 
с какого места начать чтение и как быстро продвигаться.

КЛЮЧЕВЫЕ АРХИТЕКТУРНЫЕ РАЗЛИЧИЯ

| Аспект            | RabbitMQ (умный брокер)       | Kafka (глупый брокер)         |
|-------------------|-------------------------------|-------------------------------|
| Модель данных     | Очереди сообщений             | Распределенный лог            |
| Хранение          | Удаляет после ACK             | Хранит по времени/размеру     |
| Масштабирование   | Вертикальное + кластеризация  | Горизонтальное через партиции |
| Гарантии          | Гарантированная доставка      | Сохранение порядка в партиции |
| Использование     | Команды, задачи, RPC          | Потоки событий, аналитика     |

КОГДА ЧТО ВЫБИРАТЬ?

RabbitMQ идеален для:
- Систем, где важна гарантированная доставка каждого сообщения
- Сценариев типа ""работай-и-забудь"" (fire-and-forget)
- Микросервисной архитектуры с точечной коммуникацией
- Задач, требующих сложной маршрутизации

Kafka превосходит в:
- Обработке потоков событий в реальном времени
- Сценариях, где multiple consumers нуждаются в одних и тех же данных
- Event sourcing и CQRS архитектурах
- Аналитике и машинном обучении на потоковых данных

ВЫВОД:
RabbitMQ — это ""умная почта"", Kafka — ""глупый, но надежный журнал"".
Выбор зависит от требований к доставке сообщений и архитектуры системы.
";

            return Ok(explanation);
        }
    }
}
